<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSM Search with Autocomplete</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #map {
            width: 100%;
            height: 500px;
            margin-top: 10px;
        }
        #search-container {
            margin: 10px;
            position: relative;
            display: inline-block;
        }
        #searchBox {
            padding: 8px;
            width: 300px;
            font-size: 16px;
        }
        #suggestions {
            position: absolute;
            width: 300px;
            background: white;
            border: 1px solid #ccc;
            max-height: 150px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }
        .suggestion-item {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .suggestion-item:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>

    <h2>Search Location with Suggestions</h2>
    
    <!-- Search Bar with Suggestions -->
    <div id="search-container">
        <input type="text" id="searchBox" placeholder="Enter location (e.g., Pune, India)" oninput="fetchSuggestions()">
        <div id="suggestions"></div>
    </div>

    <div id="map"></div> <!-- Map Container -->

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
        // Initialize the map centered on Pune, India
        var map = L.map('map').setView([18.5204, 73.8567], 13);

        // Add OpenStreetMap Tile Layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Marker for searched location
        var marker = L.marker([18.5204, 73.8567]).addTo(map)
            .bindPopup("<b>Welcome to Pune!</b><br>Find your PG here.")
            .openPopup();

        // Function to fetch location suggestions
        function fetchSuggestions() {
            var query = document.getElementById("searchBox").value.trim();
            var suggestionsContainer = document.getElementById("suggestions");

            if (query.length < 3) {
                suggestionsContainer.style.display = "none"; // Hide suggestions for short queries
                return;
            }

            var url = `https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=5`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    suggestionsContainer.innerHTML = "";
                    if (data.length > 0) {
                        data.forEach(place => {
                            let item = document.createElement("div");
                            item.classList.add("suggestion-item");
                            item.textContent = place.display_name;
                            item.onclick = function () {
                                selectLocation(place);
                            };
                            suggestionsContainer.appendChild(item);
                        });
                        suggestionsContainer.style.display = "block";
                    } else {
                        suggestionsContainer.style.display = "none";
                    }
                })
                .catch(error => {
                    console.log("Error fetching suggestions:", error);
                    alert("Error fetching location data. Try again later.");
                });
        }

        // Function to select a location from suggestions
        function selectLocation(place) {
            var lat = parseFloat(place.lat);
            var lon = parseFloat(place.lon);
            var suggestionsContainer = document.getElementById("suggestions");

            // Update search box with selected location
            document.getElementById("searchBox").value = place.display_name;
            suggestionsContainer.style.display = "none"; // Hide suggestions

            // Move map to selected location
            map.setView([lat, lon], 13);

            // Update marker position
            marker.setLatLng([lat, lon])
                  .bindPopup(`<b>${place.display_name}</b>`)
                  .openPopup();
        }

        // Hide suggestions when clicking outside
        document.addEventListener("click", function (e) {
            if (!document.getElementById("search-container").contains(e.target)) {
                document.getElementById("suggestions").style.display = "none";
            }
        });
    </script>

</body>
</html>
